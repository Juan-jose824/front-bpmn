<header class="top-header">
    <div class="left-selection">
        <button class="menu-toggle" (click)="toggleMenu()">â˜°</button>
        <span class="brand">Diagramas BPMN</span>
    </div>

    <div class="right-section">
        <span class="user-name">{{ userName }}</span>
        <div class="user-avatar" (click)="toggleProfile()">
            <img *ngIf="profileImage" [src]="profileImage + '?rev=' + refreshKey" />
            <span *ngIf="!profileImage">
                {{ userName ? userName.charAt(0).toUpperCase() : 'U' }}
            </span>
        </div>
        <button class="theme-toggle" (click)="toggleTheme()">
            {{ isDarkMode ? 'â˜¼ï¸Ž' : 'â˜¾' }}
        </button>
    </div>
</header>

<div class="sidebar-overlay" *ngIf="isMenuOpen" (click)="toggleMenu()"></div>

<aside class="sidebar" [class.open]="isMenuOpen">
    <div class="sidebar-header">
        <div class="sidebar-tittle">MenÃº</div>
        <button class="close-sidebar" (click)="toggleMenu()">âœ•</button>
    </div>
    <nav>
        <a class="nav-item" routerLink="/analisis" routerLinkActive="active" (click)="isMenuOpen = false">Inicio</a>
        <a class="nav-item" routerLink="/history" routerLinkActive="active" (click)="isMenuOpen = false">Historial</a>
        <a class="nav-item" *ngIf="userRole === 'Admin'" routerLink="/user-register" routerLinkActive="active" (click)="isMenuOpen = false">Registrar Usuarios</a>
        <div class="divider"></div>
        <a class="nav-item logout" (click)="logout()">Cerrar SesiÃ³n</a>
    </nav>
</aside>

<div class="layout-content">
    <router-outlet></router-outlet>
</div>

<div class="profile-overlay" *ngIf="isProfileOpen" (click)="toggleProfile()"></div>

<div class="profile-modal" *ngIf="isProfileOpen">
    <div class="modal-header">
        <h2>Perfil de Usuario</h2>
        <button (click)="toggleProfile()">âœ•</button>
    </div>
    <p class="subtitle">Gestiona tu informaciÃ³n personal</p>
    <div class="avatar-large">
        <img *ngIf="profileImage" [src]="profileImage + '?rev=' + refreshKey" />
        <span *ngIf="!profileImage">
            {{ userName ? userName.charAt(0).toUpperCase() : 'U' }}
        </span>
    </div>
    <label class="upload-btn">
        ðŸ“· Cambiar imagen
        <input type="file" accept="image/*" (change)="onImageSelected($event)" hidden />
    </label>
    <div class="profile-info">
        <label>Nombre de usuario</label>
        <p>{{ userName }}</p>
        <label>Rol</label>
        <span class="role-badge">{{ userRole }}</span>
    </div>
</div>

<div class="toast-notification" [class.show]="showToast">
    <span class="icon">âœ…</span>
    <span class="message">Imagen actualizada con Ã©xito</span>
</div>